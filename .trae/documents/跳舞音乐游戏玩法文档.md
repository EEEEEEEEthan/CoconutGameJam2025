# 跳舞音乐游戏玩法文档

## 1. 产品概述

一个独立的节拍音乐玩法系统，通过API接口启动。玩家需要在正确的时机按下按键来获得分数。核心玩法是3D音符模型在3D世界空间中从指定起点飞向目标位置，当模型到达判定区域时，玩家按下按键即可得分。整个玩法在3D世界空间中实现，完全独立运行，不与其他玩法系统耦合。

## 2. 核心功能

### 2.1 核心功能

跳舞音乐独立玩法系统的最小可行功能：

1. **3D模型系统**：3D音符模型的生成、移动和消失
2. **事件监听**：提供正确、错误、miss三种状态的事件接口
3. **数据读取**：从txt文件读取音符时序数据

### 2.2 核心功能详情

| 功能模块 | 功能描述              |
| ---- | ----------------- |
| 3D模型系统 | 3D音符模型的生成、移动和消失     |
| 事件监听 | 提供正确、错误、miss三种状态的事件接口  |
| 数据读取 | 从txt文件读取音符时序数据      |
| 判定系统 | 按键时机判定和准确度计算     |
| 分数统计 | 正确/错误/miss次数统计和结果回调 |

### 2.2 数据格式规范

**音符数据文件格式**：

* 文件类型：txt文本文件

* 编码格式：UTF-8

* 每行一条音符数据

* 格式：`[时间]键`

  * 时间：小数，表示从游戏开始到此音符的秒数

  * 键：键盘按键（不区分大小写）

**示例文件内容**：

```
[1.2]A
[1.5]S
[2.0]D
[2.3]A
[3.1]S
```

**解析规则**：

* 忽略空行和注释行（以#开头）

* 时间必须按升序排列

* 支持的按键：A-Z、0-9、空格键等常用键

## 3. 核心流程

玩家操作流程：

1. 调用Start API启动跳舞玩法系统
2. 系统加载txt文件中的音符数据
3. 3D音符模型按时序从起点生成，飞向目标位置
4. 当模型到达判定区域时，玩家按下对应按键
5. 系统判定按键时机和准确性，给予分数反馈
6. 所有音符完成后，玩法自动结束并通过回调返回统计结果

```Java
graph TD
    A[游戏开始] --> B[音符生成]
    B --> C[音符移动]
    C --> D[到达判定区域]
    D --> E[玩家按键]
    E --> F[判定结果]
    F --> G[更新分数]
    G --> H{游戏是否结束}
    H -->|否| B
    H -->|是| I[结算界面]
```

## 4. 技术接口

### 4.1 启动API

系统提供以下启动接口：

```csharp
public void Start(Action<(int correct, int wrong, int miss)> callback);
```

**参数说明**：

* **callback**：游戏结束时的回调函数，返回游戏统计结果

  * **correct**：正确按键次数

  * **wrong**：错误按键次数

  * **miss**：未按键或时机不准确次数

### 4.2 事件监听接口

系统内部处理以下三种状态：

* **正确**：玩家在正确时机按下正确按键

* **错误**：玩家按下了错误的按键

* **Miss**：玩家未在规定时间内按键或时机不准确

### 4.2 UI实现要求

当前阶段只需实现基础的3D模型功能：

* **生成**：根据txt文件数据在指定时间生成3D音符模型

* **移动**：3D模型沿指定轨迹飞向目标位置

* **消失**：模型到达判定区域后消失（无论是否被正确按键）

### 4.3 3D实现要求

* **3D空间设置**：在3D世界空间中设置音符飞行轨道

* **模型管理**：使用GameObject和Transform组件控制3D模型

* **轨迹设计**：定义3D模型从起点到判定区域的飞行路径

* **判定区域**：在3D空间中设置判定触发区域

